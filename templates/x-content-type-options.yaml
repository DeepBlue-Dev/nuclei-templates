id: x-content-type-options-checks
info:
  name: X-Content-Type-Options Header Check
  author: Hamed Salimian, Arthur Bayart
  severity: low
  classification:
    cwe-id: CWE-116
  reference:
    - https://cheatsheetseries.owasp.org/cheatsheets/Content_Security_Policy_Cheat_Sheet.html
  tags: x_content_type_options,header,security,14.4.4
  description: |
    Verify that all responses contain a X-Content-Type-Options: nosniff header.
    This header is used to prevent MIME type sniffing, which can lead to security vulnerabilities if the browser incorrectly interprets the content type of a response.
    The only correct value for this header is "nosniff".

http:
  - global-matchers: true
    method: GET
    path: 
      - "{{BaseURL}}"
    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36"
      Accept: "*/*"
      Connection: close
      Host: "{{Hostname}}"
    extractors:
      - type: kval
        name: "X-Content-Type-Options"
        part: header
        kval:
          - X_Content_Type_Options
    stop-at-first-match: true
    matchers:
      
      - type: dsl
        name: 'X-Content-Type-Options: nosniff header does not exist.'
        dsl:
          - '!contains(header, "X-Content-Type-Options: nosniff")'
      - type: dsl
        name: 'X-Content-Type-Options is not set to nosniff'
        dsl:
          - 'contains(header, "X-Content-Type-Options")'
